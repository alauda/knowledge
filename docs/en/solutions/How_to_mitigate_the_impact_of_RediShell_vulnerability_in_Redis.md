---
products:
   - Alauda Application Services
   - Alauda DevOps
kind:
   - Solution
id: xxx
---

# How to mitigate the impact of the "Lua Use-After-Free may lead to remote code execution" vulnerability in Redis

## Issue

An authenticated user may use a specially crafted Lua script to manipulate the garbage collector, trigger a use-after-free and potentially lead to remote code execution.

The problem exists in all versions of Redis with Lua scripting; therefore, Redis Operator deployed on ACP 3.14 to ACP 4.1 will be affected.

## Resolution

### If the business does not use Redis Lua scripting feature

#### ACP >= 3.16 and Redis >= 6.0

Redis 6.0 supports using ACL to configure user permissions. Follow these steps to revoke user permissions to execute Lua scripts:

1. Go to **Instance Detail** > **User Management**.
2. Select the user to update, and click "Update Privileges" from the dropdown menu on the right.
3. Select **Custom** permissions, copy the original permissions, and add `-eval -evalsha` at the end.
   > For Redis 7.2, also add `-eval_ro -evalsha_ro`

> The final permissions might be: `+@all -acl -flushall -flushdb -keys ~* -eval -evalsha`

##### ACP <= 3.14 or Redis <= 5.0

> If ACP >= 3.16 and Redis <= 5.0, it is recommended to upgrade to Redis 6.0 first and disable Lua-related commands using ACL.

In this case, you need to use rename-command to disable Lua-related commands.
> Note: Configuring rename-command will cause the instance to restart. Please ensure this operation is performed during off-peak business hours.

1. Go to **Instance Detail** > **Parameters**.
2. Click **Update Parameters**
3. Add or update the `rename-command` parameter, add or append `eval "" evalsha ""`
4. Click **Update**

### If the business uses Redis Lua scripting feature

#### Confirm that Lua scripts in business code have no security injection risks

Review the business code, strengthen parameter type checking, and ensure there are no security injection risks in the commands executing Lua scripts.

#### Wait for new version release

New versions of Alauda Cache Service for Redis OSS `4.0` and `4.1` will be continuously released. Please stay tuned. For fixes in other versions, please coordinate with the project manager.