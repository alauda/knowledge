---
products:
   - Alauda Application Services
   - Alauda DevOps
kind:
   - Solution
id: xxx
---

# How to mitigate the impact of RedisShell vulnerability in Redis

## Issue

CVE ID: [CVE-2024-22829](https://github.com//redis/redis/security/advisories/GHSA-4789-qfc9-5f9q)

An authenticated user may use a specially crafted Lua script to manipulate the garbage collector, trigger a use-after-free and potentially lead to remote code execution.

The problem exists in all versions of Redis with Lua scripting; therefore, all versions of Redis Operator will be affected.


## Resolution

### If the business does not use Redis Lua scripting feature

| ACP Version  | Redis Version  | Mitigation Method                |
|--------------|----------------|----------------------------------|
| ACP >= 3.16  | 5.0            | It's need to use rename-command to disable Lua-related commands.<br>1. Go to **Instance Detail** > **Parameters**.<br>2. Click **Update Parameters**<br>3. Add or update the `rename-command` parameter, add or append `eval "" evalsha ""`<br>4. Click **Update**. <br><br> **It is recommended to upgrade to Redis 6.0 first and disable Lua-related commands using ACL.** <br>|
| ACP >= 3.16  | 6.0            | Redis 6.0 supports using ACL to configure user permissions. Follow these steps to revoke user permissions to execute Lua scripts:<br>1. Go to **Instance Detail** > **User Management**.<br>2. Select the user to update, and click "Update Privileges" from the dropdown menu on the right.<br>3. Select **Custom** permissions, copy the original permissions, and add `-eval -evalsha` at the end.<br> |
| ACP >= 3.16  | 7.2            | Redis 7.2 supports using ACL to configure user permissions. Follow these steps to revoke user permissions to execute Lua scripts:<br>1. Go to **Instance Detail** > **User Management**.<br>2. Select the user to update, and click "Update Privileges" from the dropdown menu on the right.<br>3. Select **Custom** permissions, copy the original permissions, and add `-eval -evalsha -eval_ro -evalsha_ro` at the end.<br> |
| ACP <= 3.14  | 4.0, 5.0, 6.0, 7.2    | It's need to use rename-command to disable Lua-related commands.<br>1. Go to **Instance Detail** > **Parameters**.<br>2. Click **Update Parameters**<br>3. Add or update the `rename-command` parameter, add or append `eval "" evalsha ""`<br>4. Click **Update**. <br>|

### If the business uses Redis Lua scripting feature

#### Confirm that Lua scripts in business code have no security injection risks

Review the business code, strengthen parameter type checking, and ensure there are no security injection risks in the commands executing Lua scripts.

#### Wait for new version release

New versions of Alauda Cache Service for Redis OSS `4.0` and `4.1` will be released in the following weeks. Please stay tuned. For fixes in other versions, please coordinate with the project manager.
