---
kind:
  - Solution
products:
  - Alauda Container Platform
ProductsVersion:
  - 4.x
id: KB260100018
sourceSHA: 55c6da713196bc8126e6a059573f3c709c258c1b3899f77b33c6791d076c5b7b
---

# Alauda Container Platform 注册中心与注册中心网关容量规划指南

## 引言

本文档提供了在 Kubernetes 环境中 **Alauda Container Platform 注册中心** 的硬件资源规格建议。该堆栈由两个核心组件组成：

- **Alauda Container Platform 注册中心**：负责存储和分发镜像层和清单的 OCI 镜像注册服务器。它对 I/O 和网络要求较高。
- **注册中心网关**：一个代理中间件，在请求到达注册中心之前，强制执行镜像大小限制和仓库标签数量限制等策略。它主要对 CPU 和网络延迟要求较高。

这些建议基于对组件架构、源代码和已知性能特征的分析，针对三种常见的部署规模。

## 组件分析与资源配置

### Alauda Container Platform 注册中心

**资源配置**：

- **I/O 密集型**：性能在很大程度上依赖于存储后端的速度（用于层的推送/拉取操作）。
- **内存敏感**：在推送和拉取过程中需要足够的内存用于层缓存，以及处理并发连接。
- **中等 CPU**：CPU 用于压缩、哈希和请求处理。

### 注册中心网关

**资源配置**：

- **CPU 密集型**：由于 JSON 解析、大小计算和请求代理。
- **延迟敏感**：性能与后端注册中心的标签列表端点的响应时间紧密相关。
- **内存敏感**：需要缓冲大清单请求并维护会话缓存。

## 核心评估维度

本指南根据以下两个动态负载指标提供资源配置建议：

- **日均访问流量**：反映持续的日常负载水平。
- **峰值访问流量**：反映系统需要处理的最大并发压力。
  这些流量主要由两种类型的操作组成：
  - **推送操作**：触发镜像上传、清单解析和标签验证，对网关的 CPU 和内存要求较高。
  - **拉取操作**：主要对注册中心的 I/O 和网络产生压力。

## 流量级别定义

| 流量级别    | 日均拉取/推送操作 | 峰值并发拉取/推送操作 | 典型场景                                          |
| ------------ | ------------------ | ---------------------- | ------------------------------------------------- |
| 低流量      | <1,000             | < 50                   | 小团队开发/测试，使用频率低                       |
| 中等流量    | 1,000-10,000       | 50-200                 | 正式 CI/CD 流水线的生产环境                       |
| 高流量      | >10,000            | >200                   | 企业中央注册中心，多个团队共享                   |

## 推荐资源配置

### 场景 1：低流量

适用：小团队开发/测试，镜像更新不频繁

| 组件                              | 推荐副本数 | 容器资源（请求 / 限制）                          | 备注                             |
| --------------------------------- | ------------ | ------------------------------------------------ | -------------------------------- |
| Alauda Container Platform 注册中心 | 2            | CPU: `500m` / `1000m` <br> 内存: `512Mi` / `1Gi` | 基本配置足够。                   |
| 注册中心网关                     | 2            | CPU: `250m` / `500m` <br> 内存: `256Mi` / `512Mi` | 基本配置足够。                   |

### 场景 2：中等流量

适用：定期发布流程的生产环境，多个流水线

| 组件                              | 推荐副本数 | 容器资源（请求 / 限制）                          | 备注                                                   |
| --------------------------------- | ------------ | ------------------------------------------------ | ----------------------------------------------------- |
| Alauda Container Platform 注册中心 | 3            | CPU: `1000m` / `2000m` <br> 内存: `1Gi` / `2Gi` | 建议使用对象存储（兼容 S3）。                         |
| 注册中心网关                     | 3            | CPU: `500m` / `1000m` <br> 内存: `512Mi` / `1Gi` | 需要 HPA 以处理推送峰值。                             |

### 场景 3：高流量

适用：为多个团队和所有环境提供服务的企业中央注册中心

| 组件                              | 推荐副本数 | 容器资源（请求 / 限制）                          | 备注                                                    |
| --------------------------------- | ------------ | ------------------------------------------------ | ------------------------------------------------------ |
| Alauda Container Platform 注册中心 | 5            | CPU: `2000m` / `4000m` <br> 内存: `2Gi` / `4Gi` | 建议使用对象存储。                                    |
| 注册中心网关                     | 5            | CPU: `1000m` / `2000m` <br> 内存: `1Gi` / `2Gi` | HPA 是必需的，基于 CPU 和延迟指标进行扩展。           |

## 专用节点部署的考虑

在生产环境中，当满足以下任一条件时，强烈建议将 **Alauda Container Platform 注册中心** 和 **注册中心网关** 部署在 **专用节点**（与核心 PaaS 组件分开）：

- **高并发/吞吐量**：注册中心每天处理超过 10,000 次操作，或在集群扩展期间频繁进行批量镜像拉取。
- **高可用性和严格的 SLA 要求**：需要 >99.9% 的可用性，支持复制，或需要独立的升级/灾难恢复程序。
- **资源隔离和安全合规**：由于多租户或合规审计的要求，需实施单独的安全策略、日志记录和数据隔离。

**好处**：防止与关键平台服务（例如 API 服务器）的资源争用，最小化性能干扰，并简化安全管理。

## 最终建议

建议根据日常/峰值流量配置资源，低流量使用基本设置，中高流量使用 HPA。对于生产环境、高并发（超过 10k 次日常操作）或需要高可用性和强隔离的场景，强烈建议将注册中心和网关部署在专用节点上。这种方法避免了与核心 PaaS 组件的资源争用，最小化性能波动，并促进独立的灾难恢复、安全策略和存储优化，确保服务稳定性和数据隔离。
