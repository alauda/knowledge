---
kind:
  - Known Issue
products:
  - Alauda Application Services
ProductsVersion:
  - '3.x,4.x'
id: KB251000001
sourceSHA: be1ee4febb0d679a5428829c5c64eae2a0274fde94f45ceb9170bfc7bfd164f4
---

# 如何减轻 Redis 中 RediShell 漏洞的影响

## 问题

CVE ID: [CVE-2024-22829](https://github.com/redis/redis/security/advisories/GHSA-4789-qfc9-5f9q)

经过身份验证的用户可能会使用特制的 Lua 脚本来操纵垃圾收集器，触发使用后释放，并可能导致远程代码执行。

该问题存在于所有支持 Lua 脚本的 Redis 版本中；因此，所有版本的 Redis Operator 都将受到影响。

## 解决方案

### 如果业务不使用 Redis Lua 脚本功能

| ACP 版本 | Redis 版本      | 缓解方法                                                                                                                                                                                                                                                                                                                                                                                                              |
| ----------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ACP >= 3.16 | 5.0                | 使用 `rename-command` 禁用与 Lua 相关的命令。<br>1. 转到 **实例详情** > **参数**。<br>2. 点击 **更新参数**。<br>3. 添加或更新 `rename-command` 参数，附加 `eval "" evalsha ""`。<br>4. 点击 **更新**。<br><br>**我们建议首先升级到 Redis 6.0，并使用 ACL 禁用与 Lua 相关的命令。**<br>                                                                  |
| ACP >= 3.16 | 6.0                | Redis 6.0 支持使用 ACL 配置用户权限。按照以下步骤撤销用户执行 Lua 脚本的权限：<br>1. 转到 **实例详情** > **用户管理**。<br>2. 选择要更新的用户，并从右侧下拉菜单中点击“更新权限”。<br>3. 选择 **自定义** 权限，复制原始权限，并在末尾添加 `-eval -evalsha`。<br>                      |
| ACP >= 3.16 | 7.2                | Redis 7.2 支持使用 ACL 配置用户权限。按照以下步骤撤销用户执行 Lua 脚本的权限：<br>1. 转到 **实例详情** > **用户管理**。<br>2. 选择要更新的用户，并从右侧下拉菜单中点击“更新权限”。<br>3. 选择 **自定义** 权限，复制原始权限，并在末尾添加 `-eval -evalsha -eval_ro -evalsha_ro`。<br> |
| ACP <= 3.14 | 4.0, 5.0, 6.0, 7.2 | 使用 `rename-command` 禁用与 Lua 相关的命令。<br>1. 转到 **实例详情** > **参数**。<br>2. 点击 **更新参数**。<br>3. 添加或更新 `rename-command` 参数，附加 `eval "" evalsha ""`。<br>4. 点击 **更新**。<br>                                                                                                                                                                     |

### 如果业务使用 Redis Lua 脚本功能

#### 确认业务代码中的 Lua 脚本没有安全注入风险

审查业务代码，加强参数类型检查，确保执行 Lua 脚本的命令没有安全注入风险。

#### 等待新版本发布

Alauda Cache Service for Redis OSS 的新版本 `4.0` 和 `4.1` 将在接下来的几周内发布。请保持关注。对于其他版本的修复，请与项目经理协调。
